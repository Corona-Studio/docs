# Установка и настройка ProjBobcat

[[toc]]

## Установка из пакета

### Nuget

В настоящее время вы можете легко найти и загрузить пакеты ProjBobcat из Nuget. Вы можете найти ProjBobcat в менеджере пакетов Visual Studio и добавить его в свой проект.

Или вы можете вручную выполнить следующую команду в «Консоли диспетчера пакетов»:
```bash
NuGet\Install-Package ProjBobcat -Version 1.40.0
```

### .NET CLI

Чтобы установить ProjBobcat через .NET CLI, вам просто нужно переключить терминал в каталог проекта, содержащий файл .csproj, и выполнить в терминале:
```bash
dotnet add package ProjBobcat --version 1.40.0
```

### PackageReference

PackageReference — это новая спецификация управления пакетами, представленная Microsoft для современных проектов .NET.
Подробную информацию можно найти в [MSDN](https://learn.microsoft.com/en-us/nuget/consume-packages/package-references-in-project-files).

Вам просто нужно добавить в файл **[Имя проекта].csproj** вашего проекта:
```xml
<PackageReference Include="ProjBobcat" Version="1.40.0" />
```

::: tip
Здесь **1.40.0** — это номер версии ProjBobcat, вы можете заменить его другими номерами версий.
Все выпуски можно просмотреть в [ProjBobcat - Nuget](https://www.nuget.org/packages/ProjBobcat#versions-body-tab).
:::

## Ссылка на исходный код

Другой способ использовать ProjBobcat — это напрямую добавить репозиторий кода в ссылки вашего проекта.

::: info
Перед выполнением следующих команд вам может потребоваться сначала установить [Git CLI](https://git-scm.com/).
:::

### Клонирование репозитория ProjBobcat

Используйте командную строку, чтобы переключиться в корневой каталог решения вашего проекта, и выполните следующий код в командной строке, чтобы завершить клонирование репозитория:

```bash
git clone https://github.com/Corona-Studio/ProjBobcat.git
```

### Использование Git Submodule для извлечения ProjBobcat

::: tip
Git Submodule — очень полезная функция, здесь мы показываем только ее самый основной вариант использования.
Больше примеров использования вы можете найти в [официальной документации Git](https://git-scm.com/book/en/v2/Git-Tools-Submodules).
:::

Используйте командную строку, чтобы переключиться в корневой каталог решения вашего проекта, и выполните следующий код в командной строке, чтобы завершить клонирование репозитория:

```bash
git submodule add https://github.com/Corona-Studio/ProjBobcat.git
```

### Добавление ссылки на ProjBobcat

Затем в представлении **Обозреватель решений** в Visual Studio щелкните правой кнопкой мыши имя решения в верхней части дерева.
И выберите **«Добавить»-«Существующий проект»** и найдите **ProjBobcat.csproj** в папке проекта ProjBobcat, которую вы только что клонировали, в окне обзора файлов.

Затем найдите проект, на который вам нужно сослаться на ProjBobcat, в **Обозревателе решений**, щелкните его правой кнопкой мыши и выберите **«Добавить»-«Ссылка на проект»**.
Наконец, установите флажок ProjBobcat во всплывающем окне, чтобы завершить ссылку на него.

## Конфигурация перед использованием

### Изменение количества подключений по умолчанию

Перед использованием ProjBobcat вам необходимо добавить некоторый код в точку входа вашей программы (обычно **App.xaml.cs** или **Program.cs**), чтобы инициализировать связанные службы ProjBobcat.

Из-за ограничения максимального количества подключений по умолчанию в среде выполнения .NET вы можете столкнуться с узкими местами производительности при использовании модуля загрузки ProjBobcat.
Поэтому вам необходимо добавить следующий код в точку входа, чтобы изменить максимальное количество подключений по умолчанию:

```c#{3}
using System.Net;

ServicePointManager.DefaultConnectionLimit = 512;
```

### Регистрация и инициализация базовых служб

Далее вам необходимо добавить этот код в точку входа, чтобы завершить инициализацию службы ProjBobcat:

#### Инициализация контейнера служб

```c#
ServiceHelper.Init();
```

#### Инициализация службы CurseForge API (необязательно)

Эта услуга является необязательной. Если вы не используете какие-либо службы, связанные с CurseForge, вы можете пропустить этот шаг.

::: tip
Перед регистрацией в сервисе CurseForge вам необходимо подготовить API KEY, выданный официальным CurseForge.
Если у вас его еще нет, перейдите на [страницу приложения - CurseForge](https://support.curseforge.com/en/support/solutions/articles/9000208346-about-the-curseforge-api-and-how-to-apply-for-a-key), чтобы получить свой API KEY.
:::

::: warning
API KEY — это конфиденциальные личные учетные данные, пожалуйста, храните API KEY в безопасности и не передавайте его другим.
:::

```c#
CurseForgeAPIHelper.SetApiKey("[YOUR API KEY]");
```

Замените **[YOUR API KEY]** на API KEY, который вы получили от официального CurseForge.

#### Инициализация службы загрузки

При инициализации службы загрузки вы можете выбрать настройку User Agent, используемого при запросе (по умолчанию «ProjBobcat»).

```c#
HttpClientHelper.Ua = "[YOUR UA]"; // Необязательно
```

### Настройка аутентификатора входа в Microsoft

Для получения конкретных методов регистрации приложений Azure Active Directory перейдите по ссылке:
[Как зарегистрировать приложение Azure](/ruRU/projbobcat/createNewAzureApp)

::: tip
Перед настройкой аутентификатора Microsoft вам необходимо зарегистрировать свое приложение в Azure и правильно его настроить.
После завершения настройки вы получите строку Client ID.

Связанные материалы:

- [Официальный сайт Azure](https://azure.microsoft.com/en-us/)
- [Поток кода устройства](https://learn.microsoft.com/en-us/azure/active-directory/develop/scenario-desktop-acquire-token-device-code-flow?tabs=dotnet)

:::

::: warning
CLIENT ID — это конфиденциальные личные учетные данные, пожалуйста, храните CLIENT ID в безопасности и не передавайте его другим.
:::

```c#
MicrosoftAuthenticator.Configure(new MicrosoftAuthenticatorAPISettings
{
    ClientId = "[YOUR CLIENT ID]",
    TenentId = "consumers",
    Scopes = new[] { "XboxLive.signin",  "offline_access",  "openid",  "profile",  "email" }
});
```

После получения Client ID замените **[YOUR CLIENT ID]** своим Client ID.
